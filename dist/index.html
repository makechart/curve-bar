<div><style type="text/css">.pdl-layout>div[data-type=layout]{display:flex;gap:1em;justify-content:center;align-items:center}.pdl-layout>div[data-type=layout] [data-name=view]{height:100%;margin-right:1em}.pdl-layout.legend-bottom>div[data-type=layout]{flex-direction:column}.pdl-layout .pdl-cell[data-name=legend] .pdlg.vertical{min-height:fit-content}</style><script type="@plotdb/block">var mod;module.exports={pkg:{name:"curve-bar",version:"0.0.1",extend:{name:"@makechart/base"},dependencies:[]},init:function(t){var e,n,r;e=t.root,n=t.context,r=t.pubsub;return r.fire("init",{mod:mod({context:n})})}};mod=function(t){var e,u,n,r,i;e=t.context;u=e.d3,n=e.legend,r=e.chart;return{sample:function(){return{raw:[1,2,3,4,5].map(function(t){return{val:(10*Math.random()).toFixed(1),name:"N"+t}}),binding:{name:{key:"name"},value:{key:"val"}}}},config:(i=r.utils.config.from({preset:"default",legend:"legend"}),i.sort={type:"choice",values:["asc","desc","none"],default:"desc"},i.curve={padding:{type:"number",default:.1,min:0,max:1,step:.01},hole:{type:"number",default:.5,min:0,max:1,step:.01}},i),dimension:{value:{type:"R",name:"value"},name:{type:"N",name:"name"}},init:function(){var e,t=this;this.gview=u.select(this.layout.getGroup("view"));this.g=this.gview.append("g");this.tint=e=new r.utils.tint;this.parsed=[];this.arc=u.arc().innerRadius(0).outerRadius(100).startAngle(0).endAngle(Math.PI/2);this.legend=new r.utils.legend({root:this.root,name:"legend",shape:function(t){return u.select(this).attr("fill",e.get(t.text))},layout:this.layout});return this.legend.on("select",function(){t.parse();t.bind();t.resize();return t.render()})},parse:function(){var i=this;this.tint.reset();this.parsed=this.data.map(function(t,e){var n,r;n=import$({_i:e},t);if(!(r=i.parsed.filter(function(t){return t._i===e})[0])){return n}n.cur=r.cur;n.old=r.old;return n});this.extent={v:u.extent(this.parsed.map(function(t){return t.value}))};return this.legend.data(this.parsed.map(function(t){return{key:t.name,text:t.name}}))},resize:function(){var t,e,n,r,i,a=this;this.root.querySelector(".pdl-layout").classList.toggle("legend-bottom",this.cfg.legend.position==="bottom");this.legend.config(import$({},this.cfg.legend));this.legend.update();this.layout.update(false);this.parsed.sort(function(t,e){if(a.cfg.sort==="asc"){return e.value-t.value}else if(a.cfg.sort==="desc"){return t.value-e.value}else{return t._idx-e._idx}});t=this.layout.getBox("view");this.layout.getNode("view").style.width=t.height+"px";this.layout.update(false);t=this.layout.getBox("view");e=[t.width,t.height],n=e[0],r=e[1];i=Math.min(n,r);return this.scale={v:u.scaleLinear().domain([0,this.extent.v[1]]).range([0,Math.PI*3/2]),r:u.scaleBand().domain(this.parsed.filter(function(t){return!t._removing}).map(function(t,e){return e})).range([this.cfg.curve.hole*i/2,i/2])}},render:function(){var i,a,t,n,e,r,s,o=this;i=this.scale;a=this.scale.r.bandwidth();this.arc.cornerRadius(a/2);if(this.cfg!=null&&this.cfg.palette){this.tint.set(this.cfg.palette.colors.map(function(t){return t.value||t}))}this.legend.render();t=this.parsed.filter(function(t){return o.legend.isSelected(t.name)});t.map(function(t,e){t.old=t.cur||{a:0,ri:i.r(e)+a/2,ro:i.r(e)+a/2};return t.cur={a:i.v(t.value),ri:i.r(e)+a/2-a/2*(1-o.cfg.curve.padding),ro:i.r(e)+a/2+a/2*(1-o.cfg.curve.padding)}});n=function(e,n,t){return function(t){o.arc.startAngle(0).endAngle((n.a-e.a)*t+e.a).innerRadius((n.ri-e.ri)*t+e.ri).outerRadius((n.ro-e.ro)*t+e.ro);return o.arc()}};e=this.layout.getBox("view");this.g.attr("transform","translate("+e.width/2+","+e.height/2+")");r=this.g.selectAll("path.data").data(t,function(t){return t._idx});r.exit().each(function(t,e){var n,r;t._removing=true;r=t.old;r.a=(n=t.cur).a;r.ri=n.ri;r.ro=n.ro;return r=t.cur,r.a=i.v(0),r.ri=i.r(e)+a/2-a/2*(1-o.cfg.curve.padding),r.ro=i.r(e)+a/2-a/2*(1-o.cfg.curve.padding),r});r.exit().transition().delay(350).on("end",function(t){if(t._removing){return u.select(this).remove()}});r.enter().append("path").attr("class","data");this.g.selectAll("path.data").transition().duration(350).attrTween("d",function(t,e){return n(t.old,t.cur,e)}).attr("fill",function(t,e){return o.tint.get(t.name)||t._idx});s=this.g.selectAll("text.label").data(t,function(t){return t._idx});s.exit().remove();s.enter().append("text").attr("class","label").attr("opacity",0).attr("y",function(t,e){return-i.r(e)}).attr("dy",-a*1/4);return this.g.selectAll("text.label").attr("dominant-baseline","center").attr("text-anchor","end").attr("x","-.5em").text(function(t,e){return t.name}).transition().duration(350).attr("opacity",1).attr("y",function(t,e){return-i.r(e)}).attr("dy",-a*1/4)}}};function import$(t,e){var n={}.hasOwnProperty;for(var r in e)if(n.call(e,r))t[r]=e[r];return t}</script><div plug="layout"><div class="pdl-layout"><div data-type="layout"><div class="pdl-cell" data-name="view"></div><div class="pdl-cell" data-name="legend"></div></div><div data-type="render"></div></div></div></div>